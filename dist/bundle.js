!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).BloctoProvider=t()}(this,(function(){"use strict";var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function t(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}var r=t,o=n;function i(e){if(r===setTimeout)return setTimeout(e,0);if((r===t||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}"function"==typeof e.setTimeout&&(r=setTimeout),"function"==typeof e.clearTimeout&&(o=clearTimeout);var a,c=[],u=!1,s=-1;function f(){u&&a&&(u=!1,a.length?c=a.concat(c):s=-1,c.length&&l())}function l(){if(!u){var e=i(f);u=!0;for(var t=c.length;t;){for(a=c,c=[];++s<t;)a&&a[s].run();s=-1,t=c.length}a=null,u=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===n||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}h.prototype.run=function(){this.fun.apply(null,this.array)};function p(){}var d=p,v=p,m=p,b=p,y=p,g=p,w=p;var j=e.performance||{},k=j.now||j.mozNow||j.msNow||j.oNow||j.webkitNow||function(){return(new Date).getTime()};var T=new Date;var O={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||u||i(l)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:d,addListener:v,once:m,off:b,removeListener:y,removeAllListeners:g,emit:w,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*k.call(j),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-T)/1e3}},E={};function A(e,t){for(var n=0,r=e.length-1;r>=0;r--){var o=e[r];"."===o?e.splice(r,1):".."===o?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var x=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,S=function(e){return x.exec(e).slice(1)};function P(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:"/";if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(e=r+"/"+e,t="/"===r.charAt(0))}return(t?"/":"")+(e=A(R(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."}function C(e){var t=I(e),n="/"===_(e,-1);return(e=A(R(e.split("/"),(function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function I(e){return"/"===e.charAt(0)}var L={extname:function(e){return S(e)[3]},basename:function(e,t){var n=S(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},dirname:function(e){var t=S(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},sep:"/",delimiter:":",relative:function(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=P(e).substr(1),t=P(t).substr(1);for(var r=n(e.split("/")),o=n(t.split("/")),i=Math.min(r.length,o.length),a=i,c=0;c<i;c++)if(r[c]!==o[c]){a=c;break}var u=[];for(c=a;c<r.length;c++)u.push("..");return(u=u.concat(o.slice(a))).join("/")},join:function(){var e=Array.prototype.slice.call(arguments,0);return C(R(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},isAbsolute:I,normalize:C,resolve:P};function R(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}var N,_="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)};function D(){return"/tmp"}var B={EOL:"\n",tmpdir:D,tmpDir:D,networkInterfaces:function(){},getNetworkInterfaces:function(){},release:function(){return void 0!==e.navigator?e.navigator.appVersion:""},type:function(){return"Browser"},cpus:function(){return[]},totalmem:function(){return Number.MAX_VALUE},freemem:function(){return Number.MAX_VALUE},uptime:function(){return 0},loadavg:function(){return[]},hostname:function(){return void 0!==e.location?e.location.hostname:""},endianness:function(){if(void 0===N){var e=new ArrayBuffer(2),t=new Uint8Array(e),n=new Uint16Array(e);if(t[0]=1,t[1]=2,258===n[0])N="BE";else{if(513!==n[0])throw new Error("unable to figure out endianess");N="LE"}}return N}};function U(e){console.log(`[dotenv][DEBUG] ${e}`)}const $=/^\s*([\w.-]+)\s*=\s*(.*)?\s*$/,M=/\\n/g,J=/\r\n|\n|\r/;function q(e,t){const n=Boolean(t&&t.debug),r={};return e.toString().split(J).forEach((function(e,t){const o=e.match($);if(null!=o){const e=o[1];let t=o[2]||"";const n=t.length-1,i='"'===t[0]&&'"'===t[n];"'"===t[0]&&"'"===t[n]||i?(t=t.substring(1,n),i&&(t=t.replace(M,"\n"))):t=t.trim(),r[e]=t}else n&&U(`did not match key and value when parsing line ${t+1}: ${e}`)})),r}function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){W(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function X(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){H(i,r,o,a,c,"next",e)}function c(e){H(i,r,o,a,c,"throw",e)}a(void 0)}))}}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({config:function(e){let t=L.resolve(O.cwd(),".env"),n="utf8",r=!1;var o;e&&(null!=e.path&&(t="~"===(o=e.path)[0]?L.join(B.homedir(),o.slice(1)):o),null!=e.encoding&&(n=e.encoding),null!=e.debug&&(r=!0));try{const e=q(E.readFileSync(t,{encoding:n}),{debug:r});return Object.keys(e).forEach((function(t){Object.prototype.hasOwnProperty.call(O.env,t)?r&&U(`"${t}" is already defined in \`process.env\` and will not be overwritten`):O.env[t]=e[t]})),{parsed:e}}catch(e){return{error:e}}},parse:q}).config();var Y={56:"https://bsc-dataseed1.binance.org",97:"https://data-seed-prebsc-1-s1.binance.org:8545"},Z={1:"mainnet",3:"ropsten",4:"rinkeby",5:"goerli",42:"kovan"};return function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.chain,r=void 0===n?"ethereum":n,o=t.net,i=void 0===o?"rinkeby":o,a=t.rpc;if(K(this,e),W(this,"isBlocto",!0),W(this,"isConnecting",!1),W(this,"connected",!1),W(this,"server","https://1113cc198307.ngrok.io"),W(this,"infuraId","9b8c8c6aa81b483c8437e0ceb7bcc16e"),W(this,"chain",null),W(this,"net",null),W(this,"rpc",null),W(this,"chainId",null),W(this,"networkId",null),a){this.rpc=a;for(var c=0,u=Object.keys(Y);c<u.length;c++){var s=u[c];Y[s].includes(a)&&(this.chainId=s,this.chain="bsc")}}else{this.chain=r||"ethereum",this.net=i||"ropsten";for(var f=0,l=Object.keys(Z);f<l.length;f++){var h=l[f];Z[h]===i&&(this.chainId=h)}this.rpc="https://".concat(i,".infura.io/v3/").concat(this.infuraId)}this.networkId=this.chainId}var t,n,r,o,i,a,c,u;return t=e,(n=[{key:"request",value:(u=X(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=null,r=null,e.t0=t.method,e.next="eth_accounts"===e.t0?6:"eth_coinbase"===e.t0?10:"eth_chainId"===e.t0?15:"net_version"===e.t0?18:"eth_sign"===e.t0?21:"eth_sendTransaction"===e.t0?26:"eth_signTransaction"===e.t0||"eth_sendRawTransaction"===e.t0?29:31;break;case 6:return e.next=8,this.fetchAccounts();case 8:return r=e.sent,e.abrupt("break",34);case 10:return e.next=12,this.fetchAccounts();case 12:return o=e.sent,r=o[0],e.abrupt("break",34);case 15:return r="0x"+(r=this.chainId).toString(16),e.abrupt("break",34);case 18:return r="0x"+(r=this.networkId||this.chainId).toString(16),e.abrupt("break",34);case 21:return e.next=23,this.handleSign(t);case 23:return r=(r=e.sent).signature,e.abrupt("break",34);case 26:return e.next=28,this.handleSendTransaction(t);case 28:r=e.sent;case 29:return r=null,e.abrupt("break",34);case 31:return e.next=33,this.handleReadRequests(z({id:1,jsonrpc:"2.0"},t));case 33:n=e.sent;case 34:if(!n){e.next=36;break}return e.abrupt("return",n.result);case 36:return e.abrupt("return",r);case 39:throw e.prev=39,e.t1=e.catch(0),console.error(e.t1),e.t1;case 43:case"end":return e.stop()}}),e,this,[[0,39]])}))),function(e){return u.apply(this,arguments)})},{key:"enable",value:function(){var e=this;return new Promise((function(t,n){"undefined"==typeof window&&n("Currently only supported in browser");var r=document.createElement("iframe");r.setAttribute("src","".concat(e.server,"/authn?l6n=").concat(encodeURIComponent(window.location.origin),"&chain=").concat(e.chain)),r.setAttribute("style","width:100vw;height:100vh;position:fixed;top:0;left:0"),document.body.appendChild(r);var o=null;o=window.addEventListener("message",(function(i){i.origin===e.server&&("FCL::CHALLENGE::RESPONSE"===i.data.type&&(window.removeEventListener("message",o),document.body.removeChild(r),e.code=i.data.code,e.connected=!0,t()),"FCL::CHALLENGE::CANCEL"===i.data.type&&(window.removeEventListener("message",o),document.body.removeChild(r),n()))}))}))}},{key:"fetchAccounts",value:(c=X(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.server,"/api/").concat(this.chain,"/accounts?code=").concat(this.code)).then((function(e){return e.json()}));case 2:return t=e.sent,n=t.accounts,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"handleReadRequests",value:(a=X(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"handleSign",value:(i=X(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,e.next=3,fetch("".concat(this.server,"/api/").concat(this.chain,"/sign?code=").concat(this.code),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n[1]})}).then((function(e){return e.json()}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"handleSendTransaction",value:(o=X(regeneratorRuntime.mark((function e(t){var n,r,o,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,e.next=3,fetch("".concat(this.server,"/api/").concat(this.chain,"/estimatePoint?code=").concat(this.code),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n[0])}).then((function(e){return e.json()}));case 3:return r=e.sent,o=r.cost,e.abrupt("return",new Promise((function(e,t){"undefined"!=typeof window&&window.confirm||t("Currently only supported in browser");var r=Object.entries(n[0]).map((function(e){var t=F(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join("\n")+"\n"+"Point cost: ".concat(o);window.confirm(r)||t(null),fetch("".concat(i.server,"/api/").concat(i.chain,"/sendTransaction?code=").concat(i.code),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(z(z({},n[0]),{},{point:o}))}).then((function(e){return e.json()})).then((function(t){var n=t.receipt;return e(n)})).catch(t)})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}])&&Q(t.prototype,n),r&&Q(t,r),e}()}));
